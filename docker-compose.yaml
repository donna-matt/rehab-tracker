version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_APP_URL: ${NEXT_PUBLIC_APP_URL:-http://localhost:3000}
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=postgresql://rehabuser:SecurePass2026!@rehab-tracker-db-standalone:5432/rehabtracker
      - NEXTAUTH_URL=${NEXTAUTH_URL:-http://localhost:3000}
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET:-change-me-in-production}
      - NODE_ENV=production
    labels:
      - "coolify.managed=true"
      - "traefik.enable=true"
      - "traefik.http.routers.rehab-app.rule=Host(`rehab.matthias.nl`)"
      - "traefik.http.routers.rehab-app.entrypoints=http"
      - "traefik.http.services.rehab-app.loadbalancer.server.port=3000"
    networks:
      - coolify
